(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2956:(e,t,s)=>{Promise.resolve().then(s.bind(s,6912))},6912:(e,t,s)=>{"use strict";let n,r;s.r(t),s.d(t,{default:()=>G});var l=s(5155),a=s(2115);let o=(e,t)=>t.some(t=>e instanceof t),i=new WeakMap,c=new WeakMap,d=new WeakMap,x={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return u(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function u(e){if(e instanceof IDBRequest){let t=new Promise((t,s)=>{let n=()=>{e.removeEventListener("success",r),e.removeEventListener("error",l)},r=()=>{t(u(e.result)),n()},l=()=>{s(e.error),n()};e.addEventListener("success",r),e.addEventListener("error",l)});return d.set(t,e),t}if(c.has(e))return c.get(e);let t=function(e){if("function"==typeof e)return(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(m(this),t),u(this.request)}:function(...t){return u(e.apply(m(this),t))};return(e instanceof IDBTransaction&&function(e){if(i.has(e))return;let t=new Promise((t,s)=>{let n=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",l),e.removeEventListener("abort",l)},r=()=>{t(),n()},l=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",r),e.addEventListener("error",l),e.addEventListener("abort",l)});i.set(e,t)}(e),o(e,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,x):e}(e);return t!==e&&(c.set(e,t),d.set(t,e)),t}let m=e=>d.get(e),h=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],b=new Map;function p(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(b.get(t))return b.get(t);let s=t.replace(/FromIndex$/,""),n=t!==s,r=f.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(r||h.includes(s)))return;let l=async function(e,...t){let l=this.transaction(e,r?"readwrite":"readonly"),a=l.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[s](...t),r&&l.done]))[0]};return b.set(t,l),l}x=(e=>({...e,get:(t,s,n)=>p(t,s)||e.get(t,s,n),has:(t,s)=>!!p(t,s)||e.has(t,s)}))(x);let g=["continue","continuePrimaryKey","advance"],v={},j=new WeakMap,y=new WeakMap,w={get(e,t){if(!g.includes(t))return e[t];let s=v[t];return s||(s=v[t]=function(...e){j.set(this,y.get(this)[t](...e))}),s}};async function*N(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let s=new Proxy(t,w);for(y.set(s,t),d.set(s,m(t));t;)yield s,t=await (j.get(s)||t.continue()),j.delete(s)}function k(e,t){return t===Symbol.asyncIterator&&o(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&o(e,[IDBIndex,IDBObjectStore])}x=(e=>({...e,get:(t,s,n)=>k(t,s)?N:e.get(t,s,n),has:(t,s)=>k(t,s)||e.has(t,s)}))(x);let C=null;function S(){return C||(C=function(e,t,{blocked:s,upgrade:n,blocking:r,terminated:l}={}){let a=indexedDB.open(e,1),o=u(a);return n&&a.addEventListener("upgradeneeded",e=>{n(u(a.result),e.oldVersion,e.newVersion,u(a.transaction),e)}),s&&a.addEventListener("blocked",e=>s(e.oldVersion,e.newVersion,e)),o.then(e=>{l&&e.addEventListener("close",()=>l()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("expense_manager_db",0,{upgrade(e){e.objectStoreNames.contains("months")||e.createObjectStore("months",{keyPath:"id"}),e.objectStoreNames.contains("expenses")||e.createObjectStore("expenses",{keyPath:"id"}).createIndex("monthId","monthId",{unique:!1}),e.objectStoreNames.contains("meta")||e.createObjectStore("meta",{keyPath:"key"})}})),C}async function D(){return(await S()).getAll("months")}async function I(e){let t=await S();await t.put("months",e)}async function B(){return(await S()).getAll("expenses")}async function M(e){let t=await S();await t.put("expenses",e)}async function E(e){let t=await S();await t.delete("expenses",e)}async function O(e){let t=(await S()).transaction("expenses","readwrite");await Promise.all([...e.map(e=>t.store.put(e)),t.done])}async function A(e){var t;let s=await S(),n=await s.get("meta",e);return null!=(t=null==n?void 0:n.value)?t:null}async function L(e,t){let s=await S();await s.put("meta",{key:e,value:t})}function T(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function W(e,t){return"".concat(e,"-").concat(String(t).padStart(2,"0"))}function P(e){let[t,s]=e.split("-").map(Number);return{year:t,month:s}}function F(e){let{year:t,month:s}=P(e);return 12===s?W(t+1,1):W(t,s+1)}function U(e){return null==e?"—":"\xa5"+Number(e).toLocaleString("ja-JP")}function _(e){let t=0,s=0;for(let n of e)n.isFixed?t+=n.amount||0:s+=n.amount||0;return{fixed:t,variable:s,grand:t+s}}function V(e){return e.map((e,t)=>({...e,sortOrder:t}))}async function R(e,t,s){let n=new Set(t.map(e=>e.id)),r=new Set(s.map(e=>e.id)),l=new Set(e.months.map(e=>e.id)),a=0,o=0,i=0,c=0;for(let t of e.months){if(n.has(t.id)){i++;continue}await I(t),a++}for(let t of e.expenses){if(r.has(t.id)||!l.has(t.monthId)&&!n.has(t.monthId)){c++;continue}await M(t),o++}return{addedMonths:a,addedExpenses:o,skippedMonths:i,skippedExpenses:c}}function K(e){let{open:t,onClose:s,title:n,children:r}=e;return t?(0,l.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",onClick:s,children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-scale-in",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-5 pt-5 pb-2",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:n}),(0,l.jsx)("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center rounded-lg text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-colors text-xl leading-none",children:"\xd7"})]}),(0,l.jsx)("div",{className:"px-5 pb-5",children:r})]})}):null}function z(e){let{open:t,onClose:s,onSubmit:n,defaultYear:r,defaultMonth:o,existingLabels:i}=e,[c,d]=(0,a.useState)(r),[x,u]=(0,a.useState)(o);(0,a.useEffect)(()=>{t&&(d(r),u(o))},[r,o,t]);let m=W(c,x),h=i.includes(m),f=Array.from({length:11},(e,t)=>r-3+t);return(0,l.jsxs)(K,{open:t,onClose:s,title:"月を追加",children:[(0,l.jsxs)("div",{className:"flex gap-3 mb-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"text-xs text-slate-500 font-medium mb-1 block",children:"年"}),(0,l.jsx)("select",{value:c,onChange:e=>d(Number(e.target.value)),className:"w-full border border-slate-200 rounded-xl px-3 py-2.5 text-sm bg-white font-mono focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-300 transition-all",children:f.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"text-xs text-slate-500 font-medium mb-1 block",children:"月"}),(0,l.jsx)("select",{value:x,onChange:e=>u(Number(e.target.value)),className:"w-full border border-slate-200 rounded-xl px-3 py-2.5 text-sm bg-white font-mono focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-300 transition-all",children:Array.from({length:12},(e,t)=>t+1).map(e=>(0,l.jsxs)("option",{value:e,children:[e,"月"]},e))})]})]}),(0,l.jsxs)("div",{className:"text-center mb-4",children:[(0,l.jsx)("span",{className:"text-lg font-bold font-mono text-slate-700",children:m}),h&&(0,l.jsx)("p",{className:"text-red-500 text-xs mt-1 font-medium",children:"この月は既に存在します"})]}),(0,l.jsx)("button",{onClick:()=>n(c,x),disabled:h,className:"w-full py-3 rounded-xl font-semibold text-sm transition-all ".concat(h?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-gradient-to-r from-sky-500 to-indigo-500 text-white shadow-lg shadow-sky-200/50 hover:shadow-xl active:scale-[0.98]"),children:"作成する"})]})}function H(e){let{months:t,expenses:s,sortedMonths:n,backupWarning:r,lastBackup:o,createModalOpen:i,setCreateModalOpen:c,importModalOpen:d,setImportModalOpen:x,defaultCreate:u,onCreateMonth:m,onExport:h,onImport:f,onSelectMonth:b,showToast:p,loadData:g}=e,v=(0,a.useRef)(null),j=async e=>{var n;let r=null==(n=e.target.files)?void 0:n[0];if(r){try{let e=await r.text(),n=JSON.parse(e),l=function(e){if(!e||"object"!=typeof e)return{valid:!1,error:"無効なファイル形式です"};if(1!==e.schemaVersion)return{valid:!1,error:"スキーマバージョンが不一致です（期待値: ".concat(1,"）")};if(!Array.isArray(e.months)||!Array.isArray(e.expenses))return{valid:!1,error:"月または支出データが見つかりません"};let t=new Set;for(let s of e.months){if(!s.id||!s.label)return{valid:!1,error:"月データに必須フィールドがありません"};if(t.has(s.id))return{valid:!1,error:"月IDが重複しています: ".concat(s.id)};t.add(s.id)}let s=new Set;for(let t of e.expenses){if(!t.id||!t.monthId||void 0===t.label)return{valid:!1,error:"支出データに必須フィールドがありません"};if(s.has(t.id))return{valid:!1,error:"支出IDが重複しています: ".concat(t.id)};s.add(t.id)}return{valid:!0}}(n);if(!l.valid)return void p(l.error,"error");let a=await R(n,t,s);g(),f(a)}catch(e){p("インポートに失敗しました","error")}e.target.value="",x(!1)}};return(0,l.jsxs)("div",{className:"max-w-lg mx-auto px-4 py-6 pb-28",children:[(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,l.jsx)("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-sky-400 to-indigo-500 flex items-center justify-center shadow-lg shadow-sky-200/50",children:(0,l.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",children:(0,l.jsx)("path",{d:"M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"})})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:"出費管理"}),(0,l.jsx)("p",{className:"text-xs text-slate-400 font-medium",children:"月別の支出と資産を管理"})]})]})}),r&&(0,l.jsxs)("div",{className:"mb-5 p-4 bg-amber-50 border border-amber-200/60 rounded-2xl flex items-start gap-3",children:[(0,l.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"#d97706",strokeWidth:"2",className:"mt-0.5 flex-shrink-0",children:[(0,l.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),(0,l.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,l.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-amber-800 text-sm font-medium",children:o?"最終バックアップから30日以上経過しています":"バックアップがまだ作成されていません"}),(0,l.jsx)("button",{onClick:h,className:"text-amber-600 text-xs font-medium mt-1 hover:underline",children:"今すぐバックアップ →"})]})]}),0===n.length?(0,l.jsxs)("div",{className:"text-center py-20",children:[(0,l.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-slate-100 flex items-center justify-center",children:(0,l.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"#94a3b8",strokeWidth:"1.5",children:[(0,l.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),(0,l.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,l.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,l.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-5",children:"まだ月のデータがありません"}),(0,l.jsx)("button",{onClick:()=>c(!0),className:"px-7 py-3 bg-gradient-to-r from-sky-500 to-indigo-500 text-white rounded-2xl font-semibold text-sm shadow-lg shadow-sky-200/50 hover:shadow-xl active:scale-[0.98] transition-all",children:"最初の月を追加"})]}):(0,l.jsx)("div",{className:"space-y-2.5",children:n.map(e=>{let t=s.filter(t=>t.monthId===e.id),n=_(t),r=null!==e.currentAssets?e.currentAssets-n.grand:null;return(0,l.jsx)("button",{onClick:()=>b(e.id),className:"w-full text-left p-4 bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-md hover:border-slate-200 transition-all group active:scale-[0.99]",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-lg font-bold text-slate-800 font-mono tracking-tight",children:e.label}),(0,l.jsxs)("div",{className:"flex gap-4 mt-1.5",children:[(0,l.jsxs)("span",{className:"text-xs text-slate-400",children:["支出合計"," ",(0,l.jsx)("span",{className:"font-mono text-slate-600 font-medium",children:U(n.grand)})]}),t.length>0&&(0,l.jsxs)("span",{className:"text-xs text-slate-300",children:[t.length,"件"]})]})]}),(0,l.jsxs)("div",{className:"text-right flex items-center gap-3",children:[null!==r&&(0,l.jsxs)("span",{className:"text-sm font-bold font-mono tabular-nums ".concat(r>=0?"text-emerald-600":"text-red-500"),children:[r>=0?"+":"",U(r)]}),(0,l.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#cbd5e1",strokeWidth:"2",className:"group-hover:translate-x-0.5 transition-transform",children:(0,l.jsx)("path",{d:"M9 18l6-6-6-6"})})]})]})},e.id)})}),(0,l.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-t border-slate-100 p-4 safe-area-bottom",children:(0,l.jsxs)("div",{className:"max-w-lg mx-auto flex gap-2",children:[(0,l.jsxs)("button",{onClick:()=>c(!0),className:"flex-1 py-3.5 bg-gradient-to-r from-sky-500 to-indigo-500 text-white rounded-2xl font-semibold text-sm shadow-lg shadow-sky-200/50 hover:shadow-xl active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:[(0,l.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[(0,l.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,l.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"月を追加"]}),(0,l.jsx)("button",{onClick:h,className:"py-3.5 px-4 bg-slate-100 text-slate-600 rounded-2xl font-medium text-sm hover:bg-slate-200 active:scale-[0.97] transition-all",title:"バックアップ",children:(0,l.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,l.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,l.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),(0,l.jsx)("button",{onClick:()=>x(!0),className:"py-3.5 px-4 bg-slate-100 text-slate-600 rounded-2xl font-medium text-sm hover:bg-slate-200 active:scale-[0.97] transition-all",title:"インポート",children:(0,l.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,l.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,l.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})})]})}),(0,l.jsx)(z,{open:i,onClose:()=>c(!1),onSubmit:m,defaultYear:u.year,defaultMonth:u.month,existingLabels:t.map(e=>e.label)}),(0,l.jsxs)(K,{open:d,onClose:()=>x(!1),title:"データをインポート",children:[(0,l.jsx)("p",{className:"text-slate-500 text-sm mb-4 leading-relaxed",children:"JSONバックアップファイルを選択してください。既存データはそのまま保持され、新規データのみ追加されます。"}),(0,l.jsx)("input",{ref:v,type:"file",accept:".json",onChange:j,className:"w-full text-sm file:mr-3 file:py-2.5 file:px-4 file:rounded-xl file:border-0 file:bg-sky-50 file:text-sky-700 file:font-medium file:cursor-pointer hover:file:bg-sky-100 transition-all"})]})]})}function J(e){let{expense:t,index:s,totalCount:n,onUpdate:r,onDelete:o,onMenuAction:i,onDragStart:c,onDragEnd:d,isDragOver:x,onDragOver:u}=e,[m,h]=(0,a.useState)(!1),[f,b]=(0,a.useState)(!1),[p,g]=(0,a.useState)(""),v=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!m)return;let e=e=>{v.current&&!v.current.contains(e.target)&&(h(!1),b(!1))};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[m]);let j=()=>{let e=parseInt(p,10);e>=1&&e<=n&&(i("moveToPosition",s,e-1),b(!1),h(!1),g(""))};return(0,l.jsx)("div",{className:"transition-all ".concat(x?"border-t-2 border-sky-400":"border-t-2 border-transparent"),onDragOver:e=>{e.preventDefault(),u(s)},children:(0,l.jsxs)("div",{className:"group flex items-center gap-2 py-3 px-3 bg-white rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-all mb-2",children:[(0,l.jsx)("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.effectAllowed="move",c(s)},onDragEnd:d,className:"cursor-grab active:cursor-grabbing text-slate-300 hover:text-slate-500 touch-none select-none flex-shrink-0 py-1",title:"ドラッグして並べ替え",children:(0,l.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[(0,l.jsx)("circle",{cx:"5",cy:"3",r:"1.5"}),(0,l.jsx)("circle",{cx:"11",cy:"3",r:"1.5"}),(0,l.jsx)("circle",{cx:"5",cy:"8",r:"1.5"}),(0,l.jsx)("circle",{cx:"11",cy:"8",r:"1.5"}),(0,l.jsx)("circle",{cx:"5",cy:"13",r:"1.5"}),(0,l.jsx)("circle",{cx:"11",cy:"13",r:"1.5"})]})}),(0,l.jsx)("input",{type:"text",value:t.label,onChange:e=>r({...t,label:e.target.value}),placeholder:"項目名",className:"flex-1 min-w-0 bg-transparent border-0 outline-none text-sm text-slate-800 placeholder:text-slate-300 font-medium"}),(0,l.jsxs)("div",{className:"flex items-center bg-slate-50 rounded-lg px-2 py-1.5 flex-shrink-0",children:[(0,l.jsx)("span",{className:"text-slate-400 text-xs mr-1",children:"\xa5"}),(0,l.jsx)("input",{type:"number",inputMode:"numeric",value:t.amount||"",onChange:e=>r({...t,amount:Number(e.target.value)||0}),placeholder:"0",className:"w-20 bg-transparent border-0 outline-none text-sm text-right text-slate-800 font-mono tabular-nums"})]}),(0,l.jsx)("button",{onClick:()=>r({...t,isFixed:!t.isFixed}),className:"flex-shrink-0 text-xs font-semibold px-2.5 py-1 rounded-lg transition-all ".concat(t.isFixed?"bg-sky-100 text-sky-700 hover:bg-sky-200":"bg-amber-50 text-amber-600 hover:bg-amber-100"),children:t.isFixed?"固定":"変動"}),(0,l.jsxs)("div",{className:"relative flex-shrink-0",ref:v,children:[(0,l.jsx)("button",{onClick:()=>{h(!m),b(!1)},className:"w-7 h-7 flex items-center justify-center rounded-lg text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-colors",children:(0,l.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",children:[(0,l.jsx)("circle",{cx:"7",cy:"2.5",r:"1.5"}),(0,l.jsx)("circle",{cx:"7",cy:"7",r:"1.5"}),(0,l.jsx)("circle",{cx:"7",cy:"11.5",r:"1.5"})]})}),m&&(0,l.jsx)("div",{className:"absolute right-0 top-8 bg-white rounded-xl shadow-xl border border-slate-100 py-1.5 w-48 z-30 animate-scale-in",children:f?(0,l.jsxs)("div",{className:"px-4 py-3",children:[(0,l.jsxs)("p",{className:"text-xs text-slate-500 mb-2",children:["移動先（1〜",n,"）"]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{type:"number",min:1,max:n,value:p,onChange:e=>g(e.target.value),className:"flex-1 border border-slate-200 rounded-lg px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-300",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&j()}}),(0,l.jsx)("button",{onClick:j,className:"px-3 py-1.5 bg-sky-500 text-white rounded-lg text-sm font-medium hover:bg-sky-600 transition-colors",children:"移動"})]}),(0,l.jsx)("button",{onClick:()=>{b(!1),g("")},className:"mt-2 text-xs text-slate-400 hover:text-slate-600",children:"キャンセル"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onClick:()=>{i("moveToTop",s),h(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-700 hover:bg-slate-50 transition-colors",children:"先頭へ移動"}),(0,l.jsx)("button",{onClick:()=>{i("moveToBottom",s),h(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-700 hover:bg-slate-50 transition-colors",children:"末尾へ移動"}),(0,l.jsx)("button",{onClick:()=>b(!0),className:"w-full text-left px-4 py-2.5 text-sm text-slate-700 hover:bg-slate-50 transition-colors",children:"指定位置へ移動"}),(0,l.jsx)("hr",{className:"my-1 border-slate-100"}),(0,l.jsx)("button",{onClick:()=>{o(t.id),h(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-red-500 hover:bg-red-50 transition-colors",children:"削除"})]})})]})]})})}function q(e){let{open:t,onClose:s,onConfirm:n,title:r,message:a}=e;return(0,l.jsxs)(K,{open:t,onClose:s,title:r,children:[(0,l.jsx)("p",{className:"text-slate-600 text-sm mb-5 leading-relaxed",children:a}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:s,className:"flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-medium text-sm hover:bg-slate-50 transition-colors",children:"キャンセル"}),(0,l.jsx)("button",{onClick:n,className:"flex-1 py-2.5 rounded-xl bg-red-500 text-white font-medium text-sm hover:bg-red-600 transition-colors",children:"削除する"})]})]})}function Y(e){var t,s,n,r,o;let{month:i,expenses:c,sortedMonths:d,onBack:x,onNavigate:u,onCreateNextMonth:m,onUpdateMonth:h,onExpensesChanged:f,showToast:b}=e,[p,g]=(0,a.useState)(null),[v,j]=(0,a.useState)(null),[y,w]=(0,a.useState)(null),N=(0,a.useMemo)(()=>c.filter(e=>e.monthId===i.id).sort((e,t)=>e.sortOrder-t.sortOrder),[c,i.id]),k=(0,a.useMemo)(()=>_(N),[N]),C=i.label,S=null!=(n=null==(t=d.filter(e=>e.label<C).pop())?void 0:t.label)?n:null,D=null!=(r=null==(s=d.find(e=>e.label>C))?void 0:s.label)?r:null,I=null!==i.currentAssets&&void 0!==i.currentAssets?i.currentAssets-k.grand:null,B=async e=>{await M(e),f()},A=async()=>{let e={id:T(),monthId:i.id,label:"",amount:0,isFixed:!1,sortOrder:N.length};await M(e),f()},L=async e=>{await E(e);let t=V(N.filter(t=>t.id!==e).sort((e,t)=>e.sortOrder-t.sortOrder));t.length>0&&await O(t),f(),g(null)},W=async(e,t,s)=>{let n=[...N],[r]=n.splice(t,1);"moveToTop"===e?n.unshift(r):"moveToBottom"===e?n.push(r):"moveToPosition"===e&&void 0!==s&&n.splice(s,0,r);let l=V(n);await O(l),f()},P=async()=>{null!==v&&null!==y&&v!==y&&await W("moveToPosition",v,y),j(null),w(null)},F=async e=>{h({...i,currentAssets:""===e?null:Number(e)||0})};return(0,l.jsxs)("div",{className:"max-w-lg mx-auto px-4 py-4 pb-8",children:[(0,l.jsxs)("button",{onClick:x,className:"flex items-center gap-1.5 text-slate-400 hover:text-slate-600 text-sm font-medium mb-5 transition-colors active:scale-95",children:[(0,l.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M15 18l-6-6 6-6"})}),"一覧へ戻る"]}),(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[S?(0,l.jsxs)("button",{onClick:()=>{let e=d.find(e=>e.label===S);e&&u(e.id)},className:"flex items-center gap-1 text-sky-600 hover:text-sky-700 text-sm font-medium transition-colors active:scale-95",children:[(0,l.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:(0,l.jsx)("path",{d:"M15 18l-6-6 6-6"})}),S]}):(0,l.jsx)("div",{className:"w-20"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-800 font-mono tracking-tight",children:C}),D?(0,l.jsxs)("button",{onClick:()=>{let e=d.find(e=>e.label===D);e&&u(e.id)},className:"flex items-center gap-1 text-sky-600 hover:text-sky-700 text-sm font-medium transition-colors active:scale-95",children:[D,(0,l.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:(0,l.jsx)("path",{d:"M9 18l6-6-6-6"})})]}):(0,l.jsx)("button",{onClick:m,className:"flex items-center gap-1 text-indigo-500 hover:text-indigo-600 text-sm font-semibold transition-colors active:scale-95",children:"＋次月を作成"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2 mb-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-2xl p-3.5 border border-slate-100 shadow-sm",children:[(0,l.jsx)("p",{className:"text-xs text-sky-500 font-semibold mb-1",children:"固定費"}),(0,l.jsx)("p",{className:"text-base font-bold font-mono text-slate-800 tabular-nums",children:U(k.fixed)})]}),(0,l.jsxs)("div",{className:"bg-white rounded-2xl p-3.5 border border-slate-100 shadow-sm",children:[(0,l.jsx)("p",{className:"text-xs text-amber-500 font-semibold mb-1",children:"変動費"}),(0,l.jsx)("p",{className:"text-base font-bold font-mono text-slate-800 tabular-nums",children:U(k.variable)})]}),(0,l.jsxs)("div",{className:"bg-gradient-to-br from-slate-700 to-slate-800 rounded-2xl p-3.5 shadow-sm",children:[(0,l.jsx)("p",{className:"text-xs text-slate-300 font-semibold mb-1",children:"支出合計"}),(0,l.jsx)("p",{className:"text-base font-bold font-mono text-white tabular-nums",children:U(k.grand)})]})]}),(0,l.jsx)("div",{className:"mb-4",children:0===N.length?(0,l.jsx)("div",{className:"text-center py-12",children:(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:"支出項目がありません"})}):N.map((e,t)=>(0,l.jsx)(J,{expense:e,index:t,totalCount:N.length,onUpdate:B,onDelete:e=>g(e),onMenuAction:W,onDragStart:e=>j(e),onDragEnd:P,isDragOver:y===t&&v!==t,onDragOver:e=>w(e)},e.id))}),(0,l.jsxs)("button",{onClick:A,className:"w-full py-3.5 border-2 border-dashed border-slate-200 rounded-2xl text-slate-400 hover:border-sky-300 hover:text-sky-500 font-medium text-sm transition-all flex items-center justify-center gap-2 mb-8 active:scale-[0.99]",children:[(0,l.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[(0,l.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,l.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"項目を追加"]}),(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-100 shadow-sm p-5",children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-slate-500 mb-3",children:"現在の資産"}),(0,l.jsxs)("div",{className:"flex items-center bg-slate-50 rounded-xl px-4 py-3 mb-4",children:[(0,l.jsx)("span",{className:"text-slate-400 text-lg mr-2",children:"\xa5"}),(0,l.jsx)("input",{type:"number",inputMode:"numeric",value:null!=(o=i.currentAssets)?o:"",onChange:e=>F(e.target.value),placeholder:"資産額を入力",className:"flex-1 bg-transparent border-0 outline-none text-xl font-bold font-mono text-slate-800 tabular-nums"})]}),null!==I&&(0,l.jsxs)("div",{className:"rounded-xl p-4 transition-colors ".concat(I>=0?"bg-emerald-50 border border-emerald-100":"bg-red-50 border border-red-100"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-slate-600",children:I>=0?"余剰額":"不足額"}),(0,l.jsxs)("span",{className:"text-xl font-bold font-mono tabular-nums ".concat(I>=0?"text-emerald-600":"text-red-500"),children:[I>=0?"+":"",U(I)]})]}),(0,l.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,l.jsx)("div",{className:"flex-1 h-2.5 bg-slate-200/60 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ".concat(I>=0?"bg-emerald-500":"bg-red-400"),style:{width:"".concat(Math.min(100,i.currentAssets&&i.currentAssets>0?k.grand/i.currentAssets*100:100),"%")}})}),(0,l.jsxs)("span",{className:"text-xs text-slate-400 font-mono tabular-nums w-10 text-right",children:[i.currentAssets&&i.currentAssets>0?Math.round(k.grand/i.currentAssets*100):100,"%"]})]})]})]}),(0,l.jsx)(q,{open:!!p,onClose:()=>g(null),onConfirm:()=>p&&L(p),title:"項目を削除",message:"この支出項目を削除してもよろしいですか？この操作は元に戻せません。"})]})}function $(e){let{message:t,type:s,onClose:n}=e;return(0,a.useEffect)(()=>{let e=setTimeout(n,3e3);return()=>clearTimeout(e)},[n]),(0,l.jsx)("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-50 ".concat("success"===s?"bg-emerald-600":"error"===s?"bg-red-500":"bg-amber-500"," text-white px-5 py-3 rounded-2xl shadow-2xl text-sm font-medium animate-slide-down max-w-xs text-center"),children:t})}function G(){var e;let[t,s]=(0,a.useState)([]),[n,r]=(0,a.useState)([]),[o,i]=(0,a.useState)("list"),[c,d]=(0,a.useState)(null),[x,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[f,b]=(0,a.useState)(null),[p,g]=(0,a.useState)(null),[v,j]=(0,a.useState)(!1),y=(0,a.useCallback)(async()=>{try{let[e,t]=await Promise.all([D(),B()]);s(e),r(t);let n=await A("lastBackup");g(n)}catch(e){console.error("DB load error:",e)}j(!0)},[]);(0,a.useEffect)(()=>{y()},[y]),(0,a.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(()=>{})},[]);let w=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";b({message:e,type:t})},[]),N=(0,a.useMemo)(()=>[...t].sort((e,t)=>e.label.localeCompare(t.label)),[t]),k=null!=(e=t.find(e=>e.id===c))?e:null,C=(0,a.useMemo)(()=>{if(0===N.length){let e=new Date;return{year:e.getFullYear(),month:e.getMonth()+1}}return P(F(N[N.length-1].label))},[N]),S=(0,a.useMemo)(()=>0!==t.length&&(!p||Date.now()-new Date(p).getTime()>2592e6),[p,t]),E=async(e,s)=>{let r=W(e,s);if(t.find(e=>e.label===r))return void w("この月は既に存在します","error");let l=N.length>0?N[N.length-1]:null,{month:a,expenses:o}=function(e,t){let s=T();return{month:{id:s,label:e,currentAssets:null},expenses:[...t].sort((e,t)=>e.sortOrder-t.sortOrder).map((e,t)=>({id:T(),monthId:s,label:e.label,amount:e.isFixed?e.amount:0,isFixed:e.isFixed,sortOrder:t}))}}(r,l?n.filter(e=>e.monthId===l.id).sort((e,t)=>e.sortOrder-t.sortOrder):[]);for(let e of(await I(a),o))await M(e);await y(),d(a.id),i("detail"),u(!1),w("".concat(r," を作成しました"))},O=async()=>{if(!k)return;let{year:e,month:t}=P(F(k.label));await E(e,t)},U=async()=>{let e=new Blob([JSON.stringify({schemaVersion:1,exportedAt:new Date().toISOString(),months:t,expenses:n},null,2)],{type:"application/json"}),s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download="expense_backup_".concat(new Date().toISOString().slice(0,10),".json"),r.click(),URL.revokeObjectURL(s);let l=new Date().toISOString();await L("lastBackup",l),g(l),w("バックアップを保存しました")},_=async e=>{await I(e),s(t=>t.map(t=>t.id===e.id?e:t))};return v?(0,l.jsxs)("div",{className:"min-h-screen min-h-dvh",children:[f&&(0,l.jsx)($,{...f,onClose:()=>b(null)}),"list"===o?(0,l.jsx)(H,{months:t,expenses:n,sortedMonths:N,backupWarning:S,lastBackup:p,createModalOpen:x,setCreateModalOpen:u,importModalOpen:m,setImportModalOpen:h,defaultCreate:C,onCreateMonth:E,onExport:U,onImport:e=>{w("インポート完了: 月 ".concat(e.addedMonths,"件追加, 支出 ").concat(e.addedExpenses,"件追加"))},onSelectMonth:e=>{d(e),i("detail")},showToast:w,loadData:y}):k?(0,l.jsx)(Y,{month:k,expenses:n,sortedMonths:N,onBack:()=>i("list"),onNavigate:e=>d(e),onCreateNextMonth:O,onUpdateMonth:_,onExpensesChanged:y,showToast:w}):null]}):(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-sky-400 to-indigo-500 animate-pulse"}),(0,l.jsx)("span",{className:"text-slate-400 text-sm",children:"読み込み中..."})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=2956)),_N_E=e.O()}]);